<template>
    <style>
        .fenlei{
            height: 30px;
            display: inline-block;
            border-radius:3px;
            line-height: 30px;
            vertical-align: middle;
            margin: 2px 1px;
        }
        .class-block{
            margin: 5px 0px;
            border-top: 1px solid #AAAAAA;
            display: inline-block;
            padding-top: 8px;
            width: 100%;

        }
        .class-list{
            margin: 5px 0px;
            border-bottom: 1px solid #AAAAAA;

        }
        .list-block{
            margin: 20px 0;
        }
        textarea{
            font-size: 15px !important;
            height: 150px !important;
        }
        input{
            font-size: 15px !important;
        }

    </style>
    <div class="content-block">
        <div class="class-list">
            <input type="hidden" id="typeid"/>
            <div class="class-block">
                <div class="class-name" style="display:inline-block; color: #aaaaaa">分类：</div>
                <oo>for(var i = 0; i < data.length; i++){</oo>
                <div class="button fenlei" typeId="<oo>=data[i].id</oo>" data="<oo>=data[i].name</oo>" parent="<oo>=data[i].isParent</oo>" activeStatus="false">
                    <oo>=data[i].name</oo>
                    <oo>if (data[i].isParent=="true"){</oo>
                    <lable class='mark' typeId="<oo>=data[i].id</oo>" data="<oo>=data[i].name</oo>" openstatus="false">
                        <span>&nbsp;&nbsp;+</span>
                    </lable>
                    <oo>}</oo>
                </div>
                <oo>}</oo>
            </div>
        </div>

        <div class="list-block">
            <ul>
                <li>
                    <div class="item-content">
                        <div class="item-media"><i class="icon icon-form-name"></i></div>
                        <div class="item-inner">
                            <div class="item-input">
                                <input type="text" id="title" placeholder="请输入标题">
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>

        <div class="list-block">
            <ul>
                <li class="align-top">
                    <div class="item-content">
                        <div class="item-media"><i class="icon icon-form-comment"></i></div>
                        <div class="item-inner">
                            <div class="item-input">
                                <textarea id="content" placeholder="请输入内容"></textarea>
                            </div>
                        </div>
                    </div>
                </li>
                <li>
            </ul>
        </div>

        <a href="#" class="button active confirm" style="height: 35px; font-size: 16px; line-height: 35px">确认</a>

    </div>
</template>
<script>


    $f("df", __, function(_page, _data) {

        var url = $f("tools.serverURL","archive/classification/getList");
        $f("ajax.get", url, null, "__.list", _page)();
    });

    $f("df", "__.list", function(_data, _page) {
        var content = $f("TPPL",_page,_data);
        $("#home-content").html(content);
        mainView.router.load({pageName:'home'});

        //花式单选框
        $(".fenlei").click(function(){
            fenleiclick(this);
        });

        var fenleiclick = function(flag){

            //还原其它层级下的点击激活状态
            //$(flag).parent(".class-block").siblings().find(".fenlei").attr("activeStatus",false);
            //$(flag).parent(".class-block").siblings().find(".fenlei").removeClass("active");

            //定义同级分类下的激活状态
            var activeStatus = $(flag).attr('activeStatus');

            if(activeStatus == "false"){
                $(flag).addClass("active");
                $(flag).attr("activeStatus",true);

                $(flag).siblings().attr("activeStatus",false);
                $(flag).siblings().removeClass("active");

            }else {
                $(flag).removeClass("active");
                $(flag).attr("activeStatus",false);
            }

            //拿取你点的图标属性
            var typeId=$(flag).attr("typeId");

            //将选好的分类放入html的hidden标签中
            $("#typeid").val(typeId);
        }

        //变换+ -样式 区分当前状态
        $(".mark").click(function(){
            markclick(this);
        });

        var markclick = function(flag){

            $(flag).parents(".class-block").nextAll().remove();
            $(flag).parent(".fenlei").siblings().find(".mark").html("<span >&nbsp;&nbsp;+</span>");
            $(flag).parent(".fenlei").siblings().find(".mark").attr('openstatus',false);

            var openStatus = $(flag).attr('openstatus');
            if(openStatus == 'false'){
                var html1 = "<span >&nbsp;&nbsp;-</span>";
                $(flag).attr('openstatus',true);
                $(flag).html(html1);
                loadChildrenClass(flag);


            }
            if(openStatus=="true"){
                $(flag).attr('openstatus',false);
                $(flag).html("<span >&nbsp;&nbsp;+</span>");

            }
        }

        var loadChildrenClass = function (_span){

            var typeId = $(_span).attr("typeId");

            var param = {"pid":typeId};
            var url = $f("tools.serverURL","archive/classification/getList");
            $f("ajax.get", url, param, "__.list", _span)();
            $f("df", "__.list", function(_data, _div) {

                var name = $(_div).attr("data");
                var class_html = "";
                class_html += '<div class="class-block">';
                class_html += '<div class="class-name" style="display:inline-block; color: #aaaaaa">' + name + '：</div>'
                for(var i = 0; i < _data.data.length; i++) {
                    class_html += '<div class="button fenlei" typeId="' + _data.data[i].id + '" data="' + _data.data[i].name + '" activeStatus="false" >';
                    class_html += _data.data[i].name;
                    if (_data.data[i].isParent == "true") {
                        class_html += '<lable class="mark child-mark" typeId="' + _data.data[i].id + '" data="' + _data.data[i].name + '" openStatus="false"><span>&nbsp;&nbsp;+</span></lable>';
                    }
                    class_html += '</div>';

                }
                class_html += '</div>';

                $(_div).parents(".class-block").after($(class_html));

                $(".fenlei").unbind('click').click(function () {
                    fenleiclick(this);
                });

                $(".mark").unbind('click').click(function () {
                    markclick(this);
                });

            });

        }


        //确认生成帖子
        $(".confirm").click(function () {
            var type = [];
            type.push($("#typeid").val());
            var content = $("#content").val();
            var title = $("#title").val();

            if(title==""){
                alert("标题不能为空");
            }

            if (title.length>50) {
                alert("标题字数不能超过50个");
                return;
            }

            if(content==""){
                alert("内容不能为空");
            }


            if($f("tools.checkEmp",type) == true){
                alert("请选择分类！");
                return;
            }else if($f("tools.checkEmp",title) == true || $f("tools.checkEmp",content) == true){
                alert("请输入标题或内容！");
                return;
            }


            var url = $f("tools.serverURL","archive/note/add");
            $f("ajax.get", url, {"title":title, "classificationIds":type, "context":content}, "__.list")();
        });

        $f("df", "__.list", function(_data) {
            alert(_data.message);
        });





    });



    //          一次性加载全部数据 js拼装方式

    //            var typeId = $(_span).attr("typeId");
    //            var class_html = "";
    //            class_html += '<div class="class-block">';
    //            for(var i = 0; i < _data.data.length; i++) {
    //
    //                if(_data.data[i].id == typeId){
    //                    for(var j = 0; j < _data.data[i].children.length; j++){
    //
    //                        class_html += '<div class="button fenlei" typeId="' + _data.data[i].children[j].id + '" data="' + _data.data[i].children[j].name + '">';
    //                        class_html += _data.data[i].children[j].name;
    //                        if (_data.data[i].children[j].children != undefined) {
    //                            class_html += '<lable class="mark child-mark" typeId="' + _data.data[i].children[j].id + '" data="' + _data.data[i].children[j].name + '"><span>&nbsp;&nbsp;+</span></lable>';
    //                        }
    //                        class_html += '</div>';
    //
    //                        _data.data[i].children = _data.data;
    //
    //                    }
    //                    class_html += '</div>';
    //
    //                }
    //
    //            }
    //
    //            $(_span).parents(".class-block").after($(class_html));
    //
    //            $(".fenlei").unbind('click').click(function () {
    //                fenleiclick(this);
    //            });
    //            $(".mark").unbind('click').click(function () {
    //                loadChildrenClass(this);
    //            })
    //
    //
    //

</script>


